'use strict';

window.addEventListener('DOMContentLoaded', () => {
    const body = document.querySelector('body'),
          wrapper = document.querySelector('.wrapper'),
          headerRow = document.querySelector('.header__row'),
          menu = document.querySelector('.menu'),
          iconMenu = document.querySelector('.icon-menu'),
          menuBody = document.querySelector('.menu__body'),
          menuLinks = document.querySelectorAll('.menu__link'),
          headerLang = document.querySelector(".header__lang");

    iconMenu.addEventListener('click', () => {
        iconMenu.classList.toggle('active');
        menuBody.classList.toggle('active');
        // wrapper.classList.toggle('lock');
        header.classList.toggle('lock');
        body.classList.toggle('lock');
    });

    let checkFooter = function () {
        if (wrapper.clientWidth < 991.98) {
            menu.prepend(headerLang);
        }else if (wrapper.clientWidth > 991.98) {
            headerRow.append(headerLang);
        }
    };
    checkFooter();
    window.addEventListener('resize', checkFooter);

    menuLinks.forEach(link => {
        link.addEventListener('click', () => {
            if (wrapper.clientWidth < 991.98) {
                iconMenu.classList.remove('active');
                menuBody.classList.remove('active');
                // wrapper.classList.remove('lock');
                header.classList.remove('lock');
                body.classList.remove('lock');
            }
        });
    });

// *================================================
    const doc = document.documentElement,
          header = document.querySelector('.header');

    let prevScroll = window.scrollY || doc.scrollTop;
    let curScroll;
    let direction = 0;
    let prevDirection = 0;


    
    let checkScroll = function () {
        curScroll = window.scrollY || doc.scrollTop;
        if (curScroll > prevScroll) {
            direction = 2;
        } else if (curScroll < prevScroll) {
            direction = 1;
        }

        if (direction !== prevDirection) {
            toggleHeader(direction, curScroll);
        }

        if (window.scrollY === 0) {
            header.style.background = 'transparent';
            header.style.padding = '35px 45px 31px';
        }else {
            header.style.background = '#040300';
            header.style.padding = '20px 45px';
        }

        prevScroll = curScroll;
    };

    let toggleHeader = function (direction, curScroll) {
        if (direction === 2 && curScroll > 60) {
            header.classList.add('nav-up');
            prevDirection = direction;
        } else if (direction === 1) {
            header.classList.remove('nav-up');
            prevDirection = direction;
        }
    };

    
    checkScroll();
    window.addEventListener('scroll', checkScroll);
    //* Плавный скролл===========================================================
    $(document).ready(function () {
        $("a[href*='#']").on("click", function (e) {
            var anchor = $(this);
            $('html, body').stop().animate({
                scrollTop: $(anchor.attr('href')).offset().top
            }, 777);
            e.preventDefault();
            return false;
        });
    });
    //* Плавный скролл===========================================================

    //* Список вопросов===========================================================
    const itemStartBtn = document.querySelectorAll(".item-start__qq-btn button"),
          itemStartText = document.querySelectorAll(".item-start__qq-text");

    

    itemStartBtn.forEach((btn, i) => {
        btn.addEventListener('click', () => {
            if (btn.classList.contains('active')) {
                btn.classList.remove('active');
                btn.textContent = 'Ответы на возможные вопросы';
                itemStartText[i].classList.remove('active');
                itemStartText[i].style.height = '0';
            }else {
                itemStartBtn.forEach((btn, i) => {
                    btn.classList.remove('active');
                    btn.textContent = 'Ответы на возможные вопросы';
                    itemStartText[i].classList.remove('active');
                    itemStartText[i].style.height = '0';
                });
                btn.classList.add('active');
                btn.textContent = 'Cкрыть ответы';
                itemStartText[i].classList.add('active');
                itemStartText[i].style.height = [...itemStartText[i].children].map(i => i.clientHeight).reduce((a,b)=>a+b) + 30 + 'px';
            }
        });
    });
    //* Список вопросов===========================================================

    //* График====================================================================
    const ctx = document.getElementById('lineChart');

    const plugin = {
        id: 'customCanvasBackgroundColor',
        beforeDraw: (chart, args, options) => {
            const {ctx} = chart;
            ctx.save();
            ctx.globalCompositeOperation = 'destination-over';
            ctx.fillStyle = options.color || '#99ffff';
            ctx.fillRect(0, 0, chart.width, chart.height);
            ctx.restore();
        }
    };

    let lineChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ["March", "April", "May", "June", "July", "August", "September", "October", "November"],
            datasets: [{
                    label: '10000$ инвестированные в ZeroToHero',
                    data: [1.78, 1.08, 2.30, 3.29, 6.34, 1.20, 0.33, 5.77, 5.43],
                    borderWidth: 3,
                    borderColor: '#4C5BFF',
                    backgroundColor: '#4C5BFF',
                    fill: false,
                    pointBorderWidth: 3,
                },
                {
                    label: '10000$ инвестированные в BitCoin',
                    data: [1.8, 1.8, 2, 3.9, 6.4, 1, 0.53, 5.17, 5.3],
                    borderWidth: 3,
                    borderColor: '#CFF4FF',
                    backgroundColor: '#CFF4FF',
                    fill: false,
                    pointBorderWidth: 3,
                },
                {
                    label: '10000$ инвестированные в Ethereum',
                    data: [2, 1.18, 4, 5.9, 2.4, 3, 12.53, 3.17, 9.3],
                    borderWidth: 3,
                    borderColor: '#FFE2D6',
                    backgroundColor: '#FFE2D6',
                    fill: false,
                    pointBorderWidth: 3,
                }
            ]
        },
        options: {
            plugins: {
                customCanvasBackgroundColor: {
                    color: '000',
                },
                legend: {
                    labels: {
                        font: {
                            size: 15
                        }
                    }
                }
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beingAtZero: true
                    },
                }],
                y: {
                    grid: {
                        color: '#5E5E5E'
                    }
                },
                x: {
                    grid: {
                        color: '#5E5E5E'
                    }
                }
            }
        },
        plugins: [plugin],
    });
    //* График====================================================================
});
// March 2022 - 1.78%
//  April 2022 - 1.08%
//  May 2022 - 2.30%
//  June 2022 - 3.29%
//  July 2022 - 6.34%
//  August 2022 - 11.20%
//  September 2022 - 10.33%
//  October 2022 - 5.77%
//  November 2022 - 5.43%
//  [['1.78%', '1.08%', '2.30%', '3.29%', '6.34%', '1.20%', '0.33%', '5.77%', '5.43%'], ['4', '6', '7', '2', '54', '3', '44', '11', '87'], ['5', '72', '11', '4', '6', '23', '34', '654', '55']]